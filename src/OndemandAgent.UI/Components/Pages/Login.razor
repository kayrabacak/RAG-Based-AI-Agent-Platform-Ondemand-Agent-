@page "/login"
@using OndemandAgent.UI.Dtos
@using OndemandAgent.UI.Services
@using OndemandAgent.UI.Components.Layout 
@layout EmptyLayout 
@inject AuthService AuthService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<div class="login-container d-flex justify-center align-center" style="height: 100vh; background: #f5f5f5;">
    
    <MudPaper Elevation="6" Class="login-card pa-8 rounded-xl d-flex flex-column align-center" 
              Style="width: 400px; background: linear-gradient(135deg, #1A0527 0%, #3D1255 50%, #68237F 100%); color: white;">
        
        <div class="logo-container mb-6 d-flex align-center justify-center rounded-circle" 
             Style="width: 80px; height: 80px; background: rgba(255,255,255,0.15); box-shadow: 0 0 20px rgba(255,255,255,0.1);">
            <MudIcon Icon="@Icons.Material.Filled.AutoAwesome" Color="Color.Inherit" Style="font-size: 3rem; color: #E0E0E0;" />
        </div>

        <MudText Typo="Typo.h5" Align="Align.Center" Style="color: white; font-weight: 700; letter-spacing: 1px;">YÖNETİM PANELİ</MudText>
        <MudText Typo="Typo.body2" Align="Align.Center" Class="mt-2 mb-6" Style="color: rgba(255,255,255,0.7);">OnDemand Agent'a Hoş Geldiniz</MudText>

        @if (showError)
        {
            <MudAlert Severity="Severity.Error" Variant="Variant.Filled" Class="mb-4 rounded-lg" Style="width: 100%;">E-posta veya şifre hatalı!</MudAlert>
        }

        <MudForm @ref="form" Style="width: 100%;">
            <MudTextField T="string" @bind-Value="loginModel.Email" 
                          Label="E-Posta" 
                          Variant="Variant.Outlined" 
                          InputType="InputType.Email"
                          Required="true"
                          Adornment="Adornment.Start" 
                          AdornmentIcon="@Icons.Material.Filled.Email"
                          Class="mb-4 custom-input"
                          Style="background: rgba(255,255,255,0.05); color: white;" />
            
            <MudTextField T="string" @bind-Value="loginModel.Password" 
                          Label="Şifre" 
                          Variant="Variant.Outlined" 
                          InputType="InputType.Password" 
                          Required="true"
                          Adornment="Adornment.Start" 
                          AdornmentIcon="@Icons.Material.Filled.Lock"
                          Class="mb-6 custom-input"
                          Style="background: rgba(255,255,255,0.05); color: white;" />

            <MudButton Variant="Variant.Filled" 
                       Size="Size.Large" 
                       FullWidth="true" 
                       OnClick="HandleLogin" 
                       Disabled="@isLoading"
                       Class="rounded-lg py-3"
                       Style="background: white; color: #3D1255; font-weight: bold; letter-spacing: 0.5px; transition: transform 0.2s;">
                @if (isLoading)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" Color="Color.Primary" Class="mr-2"/>
                    <span>Giriş Yapılıyor...</span>
                }
                else
                {
                    <span>GİRİŞ YAP</span>
                }
            </MudButton>
        </MudForm>

        <MudText Typo="Typo.caption" Class="mt-6" Style="color: rgba(255,255,255,0.5);">
            &copy; 2026 OnDemand Agent AI
        </MudText>
    </MudPaper>
</div>

<style>
    .custom-input label {
        color: rgba(255,255,255,0.7) !important;
    }
    .custom-input .mud-input-outlined-border {
        border-color: rgba(255,255,255,0.2) !important;
    }
    .custom-input:hover .mud-input-outlined-border {
        border-color: rgba(255,255,255,0.5) !important;
    }
    .custom-input input {
        color: white !important;
    }
    .custom-input .mud-input-adornment-start {
        color: rgba(255,255,255,0.7) !important;
    }
</style>

@code {
    private LoginRequest loginModel = new LoginRequest();
    private bool isLoading = false;
    private bool showError = false;
    private MudForm form;

    private async Task HandleLogin()
    {
        await form.Validate();
        if (!form.IsValid) return;

        isLoading = true;
        showError = false;

        bool success = await AuthService.Login(loginModel);

        if (success)
        {
            Navigation.NavigateTo("/dashboard"); 
        }
        else
        {
            showError = true;
        }

        isLoading = false;
    }
}