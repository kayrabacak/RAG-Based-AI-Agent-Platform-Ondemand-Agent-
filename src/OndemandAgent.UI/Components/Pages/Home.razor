@page "/"
@using OndemandAgent.UI.Components.Layout
@inject NavigationManager NavManager
@rendermode InteractiveServer
@layout VisitorLayout

<div class="landing">
    <div class="card">
        <div class="brand-row">
            <div class="brand-icon">
                <MudIcon Icon="@Icons.Material.Filled.AutoAwesome" Size="Size.Large" />
            </div>
            <div class="brand-text">
                <div class="title">OnDemand Agent</div>
                <div class="subtitle">Etkinlik asistanı • Ziyaretçi sohbeti</div>
            </div>
        </div>

        <div class="desc">
            Sohbete başlamak için etkinliğin <b>QR</b> kodunu okutun veya size verilen ziyaretçi linkini açın.
        </div>

        <MudAlert Severity="Severity.Info" Class="home-alert">
            Eğer buraya bir QR/link ile geldiyseniz otomatik yönlendirilmeniz gerekir.
        </MudAlert>

        <div class="actions">
            <MudButton Class="home-btn" Variant="Variant.Filled" Color="Color.Primary"
                       StartIcon="@Icons.Material.Filled.AdminPanelSettings"
                       OnClick="GoToLogin">
                Yönetim Paneline Gir
            </MudButton>

            <div class="hint">
                Etkinlik oluşturmak ve yönetmek için giriş yapın.
            </div>
        </div>
    </div>
</div>

<style>
    :root{
      --brand: #2D0E3B;
      --brand-2: #4c1d95;
      --text: #111827;
      --subtext: #6b7280;
      --border: #e5e7eb;
    }

    .landing{
      height: 100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding: 18px;
      background:
        radial-gradient(900px 520px at 50% -140px, rgba(45,14,59,0.16), transparent 60%),
        #f4f6f8;
    }

    .card{
      width:100%;
      max-width: 560px;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(6px);
      border-radius: 24px;
      border: 1px solid rgba(17,24,39,0.06);
      box-shadow: 0 18px 40px rgba(17,24,39,0.12);
      padding: 26px;
      text-align:left;
      position: relative;
      overflow: hidden;
    }

    .card::before{
      content:"";
      position:absolute;
      left: 18px;
      right: 18px;
      top: 14px;
      height: 6px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(45,14,59,0.0), rgba(45,14,59,0.45), rgba(76,29,149,0.45), rgba(45,14,59,0.0));
    }

    .brand-row{
      display:flex;
      gap: 14px;
      align-items:center;
      margin-top: 12px;
      margin-bottom: 10px;
    }

    .brand-icon{
      width: 52px;
      height: 52px;
      border-radius: 16px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: radial-gradient(circle, rgba(45,14,59,0.18), transparent 68%);
      color: var(--brand);
    }

    .title{
      font-size: 1.5rem;
      font-weight: 900;
      letter-spacing: -0.02em;
      color: var(--brand);
      line-height: 1.15;
    }

    .subtitle{
      color: var(--subtext);
      font-size: 0.92rem;
      margin-top: 2px;
    }

    .desc{
      color: rgba(17,24,39,0.78);
      margin-top: 10px;
      margin-bottom: 14px;
      line-height: 1.55;
      font-size: 1rem;
    }

    .actions{
      margin-top: 14px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .hint{
      color: var(--subtext);
      font-size: 0.9rem;
      padding-left: 4px;
    }

    :deep(.home-btn){
      border-radius: 999px !important;
      background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%) !important;
      box-shadow: 0 14px 24px rgba(45,14,59,0.22) !important;
      font-weight: 800 !important;
      padding: 12px 18px;
      align-self: flex-start;
    }

    :deep(.home-btn:hover){
      transform: translateY(-1px);
      box-shadow: 0 18px 30px rgba(45,14,59,0.26) !important;
    }

    .home-alert{
      border-radius: 14px;
    }

    @@media (max-width: 480px){
      .card{ padding: 20px; border-radius: 20px; }
      .title{ font-size: 1.35rem; }
      :deep(.home-btn){ width: 100%; }
    }
</style>

@code {
    private bool hasEventId = false;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await CheckEventStatus();
    }

    private void GoToLogin()
    {
        NavManager.NavigateTo("/login");
    }

    private async Task CheckEventStatus()
    {
        isLoading = true;

        var uri = NavManager.ToAbsoluteUri(NavManager.Uri);
        var query = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);

        if (query.TryGetValue("eventId", out var eId))
        {
            hasEventId = true;
            NavManager.NavigateTo($"/chat/{eId}", forceLoad: true);
            return;
        }

        hasEventId = false;
        isLoading = false;
        await Task.CompletedTask;
    }
}
